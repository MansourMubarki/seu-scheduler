{% extends "base.html" %}
{% block content %}
  <div class="dash-header">
    <h2>مرحبًا {{ user.name }}</h2>
    <div class="dash-actions">
      <button class="btn" onclick="toggleStats()">إظهار/إخفاء الإحصائيات</button>
      <a class="btn" href="{{ url_for('export_courses_csv') }}">تصدير المحاضرات CSV</a>
      <a class="btn" href="{{ url_for('export_exams_csv') }}">تصدير الاختبارات CSV</a>
      {% if user.is_admin %}
        <a class="btn btn-warning" href="{{ url_for('admin_dashboard') }}">لوحة المشرف</a>
      {% endif %}
      <button class="btn btn-outline" onclick="window.print()">طباعة / PDF</button>
    </div>
  </div>

  <section id="stats" class="stats hidden">
    <div class="stat"><div class="num">{{ lec_count }}</div><div class="label">عدد المحاضرات</div></div>
    <div class="stat"><div class="num">{{ onsite_count }}</div><div class="label">حضوري</div></div>
    <div class="stat"><div class="num">{{ online_count }}</div><div class="label">عن بعد</div></div>
    <div class="stat"><div class="num">{{ total_hours }}</div><div class="label">إجمالي الساعات</div></div>
    <div class="stat"><div class="num">{{ exam_count }}</div><div class="label">عدد الاختبارات</div></div>
    <div class="stat"><div class="num">{{ mid_count }}</div><div class="label">ميد</div></div>
    <div class="stat"><div class="num">{{ final_count }}</div><div class="label">فاينل</div></div>
  </section>

  <div class="grid-2">
    <section class="card">
      <h3>إضافة محاضرة</h3>
      <form method="post" action="{{ url_for('add_course') }}" class="form-grid">
        <label>العنوان</label><input name="title" required>
        <label>اليوم</label>
        <select name="day" required>
          <option>Sunday</option><option>Monday</option><option>Tuesday</option>
          <option>Wednesday</option><option>Thursday</option><option>Friday</option><option>Saturday</option>
          <option>الأحد</option><option>الاثنين</option><option>الثلاثاء</option>
          <option>الأربعاء</option><option>الخميس</option><option>الجمعة</option><option>السبت</option>
        </select>
        <label>بداية</label><input type="time" name="start" required>
        <label>نهاية</label><input type="time" name="end" required>
        <label>النمط</label>
        <select name="mode"><option>حضوري</option><option>عن بعد</option></select>
        <button class="btn btn-primary" type="submit">إضافة</button>
      </form>
    </section>

    <section class="card">
      <h3>إضافة اختبار</h3>
      <form method="post" action="{{ url_for('add_exam') }}" class="form-grid">
        <label>العنوان</label><input name="title" required>
        <label>النوع</label><select name="kind"><option>ميد</option><option>فاينل</option></select>
        <label>التاريخ</label><input type="date" name="date" required>
        <label>من</label><input type="time" name="start" required>
        <label>إلى</label><input type="time" name="end" required>
        <button class="btn btn-primary" type="submit">إضافة</button>
      </form>
    </section>
  </div>

  <section class="card">
    <h3>جدولي</h3>
    <div class="table-wrapper">
      <table id="schedule-table">
        <thead>
          <tr>
            <th>العنوان</th>
            <th>اليوم</th>
            <th>من</th>
            <th>إلى</th>
            <th>النمط</th>
            <th>إجراء</th>
          </tr>
        </thead>
        <tbody>
          {% for c in courses %}
          <tr class="{% if c.mode.strip() in ['حضوري','onsite'] %}badge-onsite{% else %}badge-online{% endif %}">
            <td>{{ c.title }}</td>
            <td>{{ c.day }}</td>
            <td>{{ c.start }}</td>
            <td>{{ c.end }}</td>
            <td>
              <span class="badge {% if c.mode.strip() in ['حضوري','onsite'] %}onsite{% else %}online{% endif %}">
                {{ c.mode }}
              </span>
            </td>
            <td>
              <form method="post" action="{{ url_for('delete_course', cid=c.id) }}" onsubmit="return confirm('حذف المحاضرة؟');">
                <button class="btn btn-danger" type="submit">حذف</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <h3>اختباراتي</h3>
    <div class="table-wrapper">
      <table id="exams-table">
        <thead>
          <tr>
            <th>العنوان</th>
            <th>النوع</th>
            <th>التاريخ</th>
            <th>من</th>
            <th>إلى</th>
            <th>إجراء</th>
          </tr>
        </thead>
        <tbody>
          {% for e in exams %}
          <tr class="{% if e.kind in ['ميد','mid','Mid'] %}badge-mid{% else %}badge-final{% endif %}">
            <td>{{ e.title }}</td>
            <td>
              <span class="badge {% if e.kind in ['ميد','mid','Mid'] %}mid{% else %}final{% endif %}">{{ e.kind }}</span>
            </td>
            <td>{{ e.date }}</td>
            <td>{{ e.start }}</td>
            <td>{{ e.end }}</td>
            <td>
              <form method="post" action="{{ url_for('delete_exam', eid=e.id) }}" onsubmit="return confirm('حذف الاختبار؟');">
                <button class="btn btn-danger" type="submit">حذف</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <script>
    function toggleStats() {
      document.getElementById('stats').classList.toggle('hidden');
    }
  </script>
{% endblock %}